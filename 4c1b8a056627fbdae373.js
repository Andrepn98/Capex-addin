function showStatus(e,t){var a=document.getElementById("status");a.textContent=e,a.className=t?"status error":"status success",setTimeout(function(){a.className="status"},5e3)}function createTemplate(){Excel.run(function(e){var t=document.getElementById("startDate").value,a=parseInt(document.getElementById("numPeriods").value)||36,o=e.workbook.worksheets;return o.load("items/name"),e.sync().then(function(){for(var n=0;n<o.items.length;n++)if("Capex"===o.items[n].name){o.items[n].delete();break}var r=o.add("Capex"),g=getColumnLetter(7+a-1);for(r.getRange("A1").values=[["Capex and D&A Calculator"]],r.getRange("A1").format.font.bold=!0,r.getRange("A1").format.font.size=16,r.getRange("A1").format.font.color="#217346",r.getRange("G3").values=[["Start date"]],r.getRange("G3").format.font.bold=!0,r.getRange("H3").values=[[t]],r.getRange("H3").numberFormat=[["yyyy-mm-dd"]],n=1;n<a;n++){var m=getColumnLetter(7+n),s=getColumnLetter(6+n);r.getRange(m+"3").formulas=[["=EDATE("+s+"3,1)"]],r.getRange(m+"3").numberFormat=[["yyyy-mm-dd"]]}for(r.getRange("G4").values=[["End date"]],r.getRange("G4").format.font.bold=!0,n=0;n<a;n++)m=getColumnLetter(7+n),r.getRange(m+"4").formulas=[["=EOMONTH("+m+"3,0)"]],r.getRange(m+"4").numberFormat=[["yyyy-mm-dd"]];for(r.getRange("G5").values=[["Period"]],r.getRange("G5").format.font.bold=!0,n=0;n<a;n++)m=getColumnLetter(7+n),r.getRange(m+"5").values=[[n+1]],r.getRange(m+"5").format.horizontalAlignment="Center";r.getRange("A6").values=[["Total D&A"]],r.getRange("A6").format.font.bold=!0,r.getRange("A6:G6").format.fill.color="#FFF2CC";for(var l=0;l<a;l++)m=getColumnLetter(7+l),r.getRange(m+"6").formulas=[["=SUM("+m+"9:"+m+"50)"]],r.getRange(m+"6").numberFormat=[["#,##0.00"]],r.getRange(m+"6").format.font.bold=!0,r.getRange(m+"6").format.fill.color="#FFF2CC";for(r.getRange("A7").values=[["Capex Total"]],r.getRange("A7").format.font.bold=!0,r.getRange("A7:G7").format.fill.color="#DDEBF7",l=0;l<a;l++)m=getColumnLetter(7+l),r.getRange(m+"7").formulas=[["=SUMIF($C$9:$C$50,"+m+"4,$E$9:$E$50)"]],r.getRange(m+"7").numberFormat=[["#,##0.00"]],r.getRange(m+"7").format.font.bold=!0,r.getRange(m+"7").format.fill.color="#DDEBF7";var u=r.getRange("A8:G8");for(u.values=[["Assets","Date","End period","Period","Cost","Useful Life","Salvage"]],u.format.font.bold=!0,u.format.fill.color="#217346",u.format.font.color="#FFFFFF",l=0;l<a;l++)m=getColumnLetter(7+l),r.getRange(m+"8").format.fill.color="#217346";for(var f=9;f<=50;f++)for(r.getRange("C"+f).formulas=[["=IF(B"+f+'="","-",EOMONTH(B'+f+",0))"]],r.getRange("C"+f).numberFormat=[["yyyy-mm-dd"]],r.getRange("D"+f).formulas=[["=IF(C"+f+'="-",0,MATCH(C'+f+",$H$4:$"+g+"$4,0))"]],l=0;l<a;l++){m=getColumnLetter(7+l);var d="=IF(OR($A"+f+'="",$D'+f+"=0),0,IF(AND("+(l+1)+">=$D"+f+","+(l+1)+"<$D"+f+"+$F"+f+"),($E"+f+"-$G"+f+")/$F"+f+",0))";r.getRange(m+f).formulas=[[d]],r.getRange(m+f).numberFormat=[["#,##0.00"]]}for(r.getRange("B9:B50").numberFormat=[["yyyy-mm-dd"]],r.getRange("E9:E50").numberFormat=[["#,##0.00"]],r.getRange("G9:G50").numberFormat=[["#,##0.00"]],r.getRange("A:G").format.autofitColumns(),l=0;l<a;l++)m=getColumnLetter(7+l),r.getRange(m+"1").format.columnWidth=75;for(r.freezePanes.freezeRows(8),r.freezePanes.freezeColumns(7),r.getRange("A8:"+g+"8").format.borders.getItem("EdgeBottom").style="Continuous",f=10;f<=50;f+=2)r.getRange("A"+f+":"+g+f).format.fill.color="#F9F9F9";return r.activate(),e.sync()}).then(function(){showStatus("Template created with "+a+" periods and 42 asset rows!",!1)})}).catch(function(e){showStatus("Error: "+e.message,!0),console.error(e)})}function addAsset(){Excel.run(function(e){var t=document.getElementById("assetName").value,a=document.getElementById("assetDate").value,o=document.getElementById("assetCost").value,n=document.getElementById("usefulLife").value,r=document.getElementById("salvageValue").value||"0";if(!t||!o)return showStatus("Please fill in asset name and cost",!0),e.sync();var g=e.workbook.worksheets.getItem("Capex"),m=g.getRange("A9:A50");return m.load("values"),e.sync().then(function(){for(var s=-1,l=0;l<m.values.length;l++)if(!m.values[l][0]){s=9+l;break}return-1===s?(showStatus("No empty rows available (max 42 assets)",!0),e.sync()):(g.getRange("A"+s).values=[[t]],g.getRange("B"+s).values=[[a]],g.getRange("B"+s).numberFormat=[["yyyy-mm-dd"]],g.getRange("E"+s).values=[[parseFloat(o)]],g.getRange("E"+s).numberFormat=[["#,##0.00"]],g.getRange("F"+s).values=[[parseInt(n)]],g.getRange("G"+s).values=[[parseFloat(r)]],g.getRange("G"+s).numberFormat=[["#,##0.00"]],e.sync())}).then(function(){document.getElementById("assetName").value="",document.getElementById("assetCost").value="",showStatus("Asset '"+t+"' added!",!1)})}).catch(function(e){showStatus("Error: "+e.message,!0),console.error(e)})}function getColumnLetter(e){var t="";for(e+=1;e>0;){var a=(e-1)%26;t=String.fromCharCode(65+a)+t,e=Math.floor((e-1)/26)}return t}Office.onReady(function(e){e.host===Office.HostType.Excel&&(document.getElementById("createTemplate").onclick=createTemplate,document.getElementById("addAsset").onclick=addAsset)});